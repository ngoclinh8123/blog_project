import{r as a,X as lt,Y as it,Q as ct,x as rt,j as n,a as f,U as r,V as d,W as dt}from"./index-d386ea30.js";import{c as R}from"./convert_date-93db2282.js";import{b as p,I as ut}from"./index-bc776e5e.js";import{i as ht,E as ft,D as x,j as mt,M as _t}from"./EditOutlined-29412999.js";import{E as pt}from"./EyeOutlined-28ed04d3.js";import"./index-f9178b1e.js";import"./useBreakpoint-8ba892ee.js";const gt="_container_zimd9_1",bt="_table_zimd9_5",yt="_btn_add_zimd9_11",Ct="_btn_delete_all_disabled_zimd9_20",Pt="_btn_delete_all_zimd9_20",St="_btn_action_zimd9_22",xt="_selected_count_zimd9_42",o={container:gt,table:bt,btn_add:yt,btn_delete_all_disabled:Ct,btn_delete_all:Pt,btn_action:St,selected_count:xt},It=(l,m,g,b)=>{};function $t(){const[l,m]=a.useState([]),[g,b]=a.useState([]),[z,$]=a.useState(!1),[c,_]=a.useState(0),F=lt(),{id:y}=it(),T=ct(),{loggedIn:I,handleLogout:vt}=a.useContext(rt),[u,A]=a.useState([]),M={selectedRowKeys:u,onChange:t=>{A(t)}},U=u.length>0,C=a.useRef(null),V=a.useRef(null),{TextArea:v}=ut,[j,h]=a.useState(!1),[P]=p.useForm(),L={labelCol:{span:2},wrapperCol:{span:20}},Y=[{title:"ID",dataIndex:"id",defaultSortOrder:"descend",sorter:(t,e)=>t.id-e.id,width:"5%"},{title:"Tiêu đề",dataIndex:"title",defaultSortOrder:"descend",sorter:(t,e)=>t.title.length-e.title.length,width:"30%"},{title:"Tác giả",dataIndex:"customer",defaultSortOrder:"descend",sorter:(t,e)=>t.customer.localeCompare(e.customer),filters:X(),filterMode:"tree",filterSearch:!0,onFilter:(t,e)=>e.title.includes(t),width:"15%"},{title:"Ngày tạo",dataIndex:"created_at",defaultSortOrder:"descend",sorter:(t,e)=>t.title.length-e.title.length},{title:"Ngày cập nhật",dataIndex:"updated_at",defaultSortOrder:"descend",sorter:(t,e)=>t.title.length-e.title.length},{title:n(ht,{onClick:()=>et(),className:o.btn_add}),dataIndex:"",key:"x",render:t=>f("span",{children:[n(pt,{onClick:()=>tt(t.key),className:o.btn_action,title:"xem bài viết"}),n(ft,{onClick:()=>J(t.key),className:o.btn_action,title:"sửa bài viết"}),n(x,{onClick:()=>G(t.key),className:o.btn_action,title:"xóa bài viết"})]})}],q=K();function K(){const t=[];return l.length>0&&l.forEach(e=>{t.push({key:e.id,id:e.id,title:e.title,customer:e.customer.username,created_at:R(e.created_at),updated_at:R(e.updated_at)})}),t}function X(){const t=[],e=[];return l.length>0&&l.forEach(s=>{e.includes(s.customer.username)||e.push(s.customer.username)}),e.length>0&&e.forEach(s=>{t.push({text:s,value:s})}),t}function S(){d.get(`/api/v1/category/${y}/`).then(t=>{t&&m(t.data.data)}).catch(t=>{t.response.status===404&&m({})})}function B(){d.get("/api/v1/category/").then(t=>{t&&b(t.data.data)}).catch(t=>{t.response.status===404&&b({})})}function Q(t){let e={title:"",parent_id:"",posts:[]};return g.length>0&&g.forEach(s=>{s.id==t&&(e=s),s.childs&&s.childs.forEach(i=>{i.id==t&&(e=i)})}),e}function W(){const t=[];return l.forEach(e=>{t.push(e.id)}),t}a.useEffect(()=>{S(),B()},[F,z]),a.useEffect(()=>{dt(()=>{$(!0)})},[]);function k(t){let e={};return l.length>0&&l.forEach(s=>{t==s.id&&(e=s),s.childs&&s.childs.forEach(i=>{t==i.id&&(e=i)})}),e}function G(t){I?E(t):r.error("Please login to do this action")}function E(t){d.delete(`/api/v1/post/${t}/`).then(e=>{r.success(`Delete post ${t} successfully`),S()}).catch(e=>{e.response.status===403&&r.error(`You have no permission to delete post ${t}`)})}function H(){u.map(t=>{E(t)})}function J(t){_(t),O()}const Z=t=>{I?d.put(`/api/v1/post/${c}/`,{title:t.title,content:t.content}).then(e=>{S(),h(!1),_(0),r.success("Updated post successfully")}).catch(e=>{e.response.status===403&&(r.error("You have no permissions to edit this post"),h(!1),_(0))}):r.error("Please login to do this action")};function tt(t){T(`/app/blog/${t}`)}function et(){O()}const st=t=>{const e=t.title,s=t.content;C.current.resetFields();const i=Q(y);d.post("/api/v1/post/",{title:e,content:s}).then(N=>{const w=W(),ot=N.data.data;w.push(ot),d.put(`/api/v1/category/${y}/`,{title:i.title,parent_id:i.parent_id,posts:w}).then(D=>{r.success("Add post success"),m(D.data.data),h(!1)}).catch(D=>{})}).catch(N=>{})};a.useEffect(()=>{P.setFieldsValue({title:k(c).title,content:k(c).content})},[c]);const O=()=>{h(!0)},nt=()=>{P.submit()},at=()=>{h(!1),_(0),C.current.resetFields()};return f("div",{className:o.container,children:[f("div",{children:[n(mt,{rowSelection:M,columns:Y,dataSource:q,onChange:It,className:o.table}),f("div",{style:{marginBottom:16},className:o.selected_count,children:[n("span",{children:u.length>0?n(x,{className:o.btn_delete_all,title:"Xóa bài viết đã chọn",onClick:()=>H()}):n(x,{className:o.btn_delete_all_disabled})}),n("span",{style:{marginLeft:8},children:U?`Đã chọn ${u.length} bài viết`:""})]})]}),n(_t,{title:c==0?"Thêm bài viết mới":`Sửa bài viết ${c}`,open:j,onOk:nt,onCancel:at,width:"70%",className:o.modal,ref:V,children:f(p,{form:P,onFinish:c==0?st:Z,...L,ref:C,children:[n(p.Item,{label:"Tiêu đề",name:"title",rules:[{required:!0,message:"Vui lòng nhập trường này! "}],children:n(v,{placeholder:"Tiêu đề...",autoSize:!0})}),n(p.Item,{label:"Nội dung",name:"content",rules:[{required:!0,message:"Vui lòng nhập trường này! "}],children:n(v,{placeholder:"Nội dung...",autoSize:{minRows:3,maxRows:30}})})]})})]})}export{$t as default};
